<!doctype html>
<html>
<head>
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="full-body-container">
    <div class="title-box">
        <img src="{{ url_for('static', filename='images/TitleCard.png') }}" />
        <div class="input-box" onclick="sendFocus()">
            <img src="{{ url_for('static', filename='images/mag.png') }}" />
            <input id="filter-text-val" class="scent-search" placeholder="Try: 'floral perfume for women'" onkeyup="filterText()">
        </div>
        <div>
            <select id="brand-filter">
                <option value="">All Brands</option>
                <option value="Dior">Dior</option>
                <option value="Gucci">Gucci</option>
            </select>
            <select id="gender-filter">
                <option value="">All Genders</option>
                <option value="Women">Women</option>
                <option value="Men">Men</option>
                <option value="Unisex">Unisex</option>
            </select>
        </div>
    </div>
    <div id="answer-box"></div>
</div>

<script>
    function answerBoxTemplate(p) {
        return `<div class='perfume-result'>
            <h3>${p.name} <span class='perfume-brand'>(${p.brand})</span></h3>
            <p><strong>Top:</strong> ${p.top_notes}</p>
            <p><strong>Middle:</strong> ${p.middle_notes}</p>
            <p><strong>Base:</strong> ${p.base_notes}</p>
            <p><strong>Accords:</strong> ${p.accords}</p>
            <p><strong>Gender:</strong> ${p.gender}</p>
            <p><strong>Rating:</strong> ${p.rating}</p>
            <p><strong>Year:</strong> ${p.year}</p>
            <a href="${p.url}" target="_blank">More Info</a>
        </div>`
    }

    function sendFocus() {
        document.getElementById('filter-text-val').focus()
    }

    function filterText() {
        let query = document.getElementById("filter-text-val").value;
        let brand = document.getElementById("brand-filter").value;
        let gender = document.getElementById("gender-filter").value;

        fetch("/search?" + new URLSearchParams({ query, brand, gender }))
            .then((response) => response.json())
            .then((data) => {
                document.getElementById("answer-box").innerHTML = "";
                data.forEach(p => {
                    let tempDiv = document.createElement("div");
                    tempDiv.innerHTML = answerBoxTemplate(p);
                    document.getElementById("answer-box").appendChild(tempDiv);
                });
            });
    }
</script>
</body>
</html>
